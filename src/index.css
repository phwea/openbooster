@tailwind base;
@tailwind components;
@tailwind utilities;

html, body, #root { height: 100%; }

/* ===== CardSkin_DarkMode_RarityBorders_D4plus_V1 ===== */
.skin-card{ position:relative; border-radius:12px; overflow:hidden; background:#0b0d10; box-shadow: 0 10px 28px rgba(0,0,0,.35); outline: none; transition: box-shadow 140ms ease; }
.skin-card:focus-visible{ box-shadow: 0 10px 28px rgba(0,0,0,.35), inset 0 0 0 2px color-mix(in oklab, var(--accent, #4A90E2) 30%, transparent); }
.skin-shadow{ filter: drop-shadow(0 10px 28px rgba(0,0,0,.35)); }

/* Dark-mode frame base with rarity border */
.skin-dark .skin-frame-dark{ position:absolute; inset:0; border-radius:12px; pointer-events:none; background:
  radial-gradient(140% 100% at 50% 0%, var(--bg-color, #111418) 0%, #0B0D0F 100%);
  border: var(--border-width, 1px) solid var(--border-color, #3A4450);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08);
}
/* Hover intensify border */
.skin-dark:hover .skin-frame-dark{ filter: brightness(1.08); }
.skin-rare-active .skin-frame-dark{ filter: brightness(1.12); }
[data-motion='reduce'] .skin-dark:hover .skin-frame-dark{ filter: none }

/* Holo overlay animations per rarity */
.skin-holo-layer{ position:absolute; inset:0; border-radius:inherit; pointer-events:none; mix-blend-mode:screen; opacity:0; transition: opacity 200ms ease; }
.skin-rare-active .skin-holo-layer{ opacity:1; }

.skin-holo-subtle .skin-holo-layer{ background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.08), transparent 60%); }

.skin-holo-shimmer .skin-holo-layer{ background:
  linear-gradient(110deg, transparent 30%, rgba(168,85,247,0.3) 50%, transparent 70%);
  background-size: 200% 100%;
}
.skin-animated.skin-holo-shimmer .skin-holo-layer{ animation: holo-shimmer 3s ease-in-out infinite; }
@keyframes holo-shimmer{ 0%, 100%{ background-position: 200% 0 } 50%{ background-position: -100% 0 } }

.skin-holo-wave .skin-holo-layer{ background:
  repeating-linear-gradient(45deg, transparent 0 8px, rgba(236,72,153,0.15) 8px 16px);
  background-size: 200% 200%;
}
.skin-animated.skin-holo-wave .skin-holo-layer{ animation: holo-wave 4s linear infinite; }
@keyframes holo-wave{ to{ background-position: 200% 200% } }

.skin-holo-radial .skin-holo-layer{ background:
  radial-gradient(circle at 50% 50%, rgba(245,158,11,0.25) 0%, transparent 40%),
  radial-gradient(circle at 30% 30%, rgba(245,158,11,0.15) 0%, transparent 30%);
  background-size: 150% 150%;
}
.skin-animated.skin-holo-radial .skin-holo-layer{ animation: holo-radial 5s ease-in-out infinite; }
@keyframes holo-radial{ 0%, 100%{ background-position: 50% 50%, 30% 30% } 50%{ background-position: 60% 40%, 40% 60% } }

.skin-holo-prismatic .skin-holo-layer{ background:
  conic-gradient(from 0deg at 50% 50%, rgba(6,182,212,0.2), rgba(245,158,11,0.2), rgba(236,72,153,0.2), rgba(6,182,212,0.2));
}
.skin-animated.skin-holo-prismatic .skin-holo-layer{ animation: holo-prismatic 6s linear infinite; }
@keyframes holo-prismatic{ to{ transform: rotate(360deg) } }

.skin-holo-rainbow .skin-holo-layer{ background:
  linear-gradient(135deg, rgba(244,63,94,0.2) 0%, rgba(245,158,11,0.2) 25%, rgba(34,197,94,0.2) 50%, rgba(6,182,212,0.2) 75%, rgba(168,85,247,0.2) 100%);
  background-size: 400% 400%;
}
.skin-animated.skin-holo-rainbow .skin-holo-layer{ animation: holo-rainbow 8s ease-in-out infinite; }
@keyframes holo-rainbow{ 0%, 100%{ background-position: 0% 50% } 50%{ background-position: 100% 50% } }

.skin-holo-cosmic .skin-holo-layer{ background:
  radial-gradient(circle at 20% 30%, rgba(139,92,246,0.3) 0%, transparent 25%),
  radial-gradient(circle at 80% 60%, rgba(139,92,246,0.2) 0%, transparent 20%),
  radial-gradient(circle at 40% 80%, rgba(139,92,246,0.15) 0%, transparent 15%);
}
.skin-animated.skin-holo-cosmic .skin-holo-layer{ animation: holo-cosmic 10s ease-in-out infinite; }
@keyframes holo-cosmic{ 0%, 100%{ transform: scale(1) } 50%{ transform: scale(1.05) } }

.skin-holo-legendary .skin-holo-layer{ background:
  radial-gradient(ellipse at 50% 50%, rgba(252,211,77,0.35) 0%, transparent 50%),
  conic-gradient(from 0deg at 50% 50%, transparent 0%, rgba(252,211,77,0.2) 25%, transparent 50%, rgba(252,211,77,0.2) 75%, transparent 100%);
  background-size: 100% 100%, 200% 200%;
}
.skin-animated.skin-holo-legendary .skin-holo-layer{ animation: holo-legendary 4s linear infinite; }
@keyframes holo-legendary{ to{ background-position: 0% 0%, 100% 100% } }

[data-motion='reduce'] .skin-holo-layer{ animation: none !important; }

/* Inner stack */
.skin-inner{ position:absolute; inset:10px; border-radius:10px; display:flex; flex-direction:column; gap:8px; }

/* Header band (dark mode) */
.skin-header{ border-radius:8px; background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)); color:#E6EAEE; display:flex; align-items:center; justify-content:space-between; padding:6px 8px; box-shadow: inset 0 -1px 0 rgba(0,0,0,0.35); }
.skin-title{ font-weight:600; font-size:14px; letter-spacing:0.01em; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.skin-tags{ display:flex; gap:6px; }
.skin-tag{ font-size:11px; letter-spacing:.02em; text-transform:uppercase; padding:2px 6px; border-radius:9999px; background: rgba(255,255,255,0.06); color:#A9B0B8; border:1px solid rgba(255,255,255,0.08) }
.skin-tag:focus-visible{ outline:2px solid color-mix(in oklab, var(--accent,#4A90E2) 30%, transparent) }

/* Art window (dark mode subtle contrast) */
.skin-art{ position:relative; border-radius:8px; overflow:hidden; background: radial-gradient(100% 80% at 50% 40%, rgba(255,255,255,0.06), rgba(255,255,255,0)); min-height: calc(100% * 0.40); box-shadow: inset 0 0 0 1px rgba(0,0,0,0.35); display: flex; align-items: center; justify-content: center; }
.skin-art-clip{ position: relative; width:100%; height:100%; overflow:hidden; border-radius: inherit; perspective: 900px; transform-style: preserve-3d; }
.skin-art-layer{ position: relative; width:100%; height:100%; will-change: transform, filter; transform: translate3d(0,0,0); backface-visibility: hidden; }
/* Force set-art SVGs (which declare absolute inset-6 in markup) to fill the box */
.skin-art-layer svg, .skin-art-layer canvas{ position:absolute; left:0; right:0; top:50%; transform: translateY(-50%); display:block; width:100%; height:auto; max-height:100%; }
/* Soft blurred fill behind the main art to hide any vertical margins while keeping the primary art fully visible */
.skin-art-underlay{ position:absolute; inset:0; border-radius:inherit; overflow:hidden; filter: blur(8px) saturate(1.1) brightness(0.9); transform: scale(1.06); pointer-events:none }
.skin-art-underlay svg{ position:absolute; inset:0 !important; width:100%; height:100%; display:block }
.skin-art-contain{ width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden; }
.skin-art-contain canvas, .skin-art-contain svg{ display:block; width:100%; height:100%; object-fit: cover; }
.skin-art-gloss{ position:absolute; inset:0; background: linear-gradient(12deg, rgba(255,255,255,0.00) 40%, rgba(255,255,255,0.10) 55%, rgba(255,255,255,0.00) 70%); mix-blend-mode: screen; opacity:.20; pointer-events:none }

/* Full-art layout for illustration rarities */
.skin-fullart .skin-inner{ gap: 0; }
.skin-fullart-bg{ position: absolute; inset: 2px; border-radius: 10px; overflow: hidden; z-index: 0; }
.skin-fullart-bg canvas, .skin-fullart-bg svg{ position:absolute; inset:0 !important; display: block; width: 100%; height: 100%; object-fit: cover; }
.skin-fullart-overlay{ position: absolute; inset: 0; background: linear-gradient(180deg, rgba(11,13,15,0) 0%, rgba(11,13,15,0.3) 50%, rgba(11,13,15,0.85) 100%); pointer-events: none; }
.skin-fullart .skin-header{ z-index: 5; position: relative; background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.4)); backdrop-filter: blur(8px); }
.skin-fullart .skin-footer{ margin-top: auto; }

/* Info panel (dark mode deep neutral) */
.skin-info{ position:relative; border-radius:8px; overflow:hidden; }
.skin-paper{ position:absolute; inset:0; background: #161A20; }
.skin-paper::after{ content:""; position:absolute; inset:0; opacity:.06; background:
  repeating-linear-gradient(0deg, rgba(255,255,255,0.35) 0 1px, rgba(255,255,255,0) 1px 3px),
  repeating-linear-gradient(90deg, rgba(255,255,255,0.20) 0 1px, rgba(255,255,255,0) 1px 4px);
  mix-blend-mode: screen;
}
.skin-textlines{ position:relative; display:flex; flex-direction:column; gap:6px; padding:8px 10px; }
.skin-line{ height:10px; border-radius:4px; background: rgba(255,255,255,0.10) }
.skin-line.short{ width:60% }

/* Footer (dark mode) */
.skin-footer{ display:flex; align-items:center; justify-content:space-between; color:#A9B0B8; }
.skin-pill{ display:inline-flex; align-items:center; gap:6px; font-size:11px; padding:4px 8px; border-radius:9999px; border:1px solid rgba(255,255,255,0.08); background: rgba(0,0,0,0.35); backdrop-filter: blur(4px); }
.skin-dot{ width:8px; height:8px; border-radius:9999px; box-shadow: 0 0 0 2px rgba(0,0,0,0.08) inset; filter: saturate(1.2) brightness(1.1); }
.skin-number{ font-size:12px; font-weight:500; color:#A9B0B8 }

/* Crown embellishment: gold border + bloom */
.skin-crown .skin-frame-dark{ border-color: #FCD34D; }
.skin-crown::before{ content:""; position:absolute; inset:-2px; border-radius:14px; pointer-events:none; background: radial-gradient(140% 90% at 50% 0%, rgba(252,211,77,0.15), rgba(252,211,77,0)); mix-blend-mode: screen }

/* Hover motion */
.skin-card{ transition: transform 140ms ease, box-shadow 140ms ease }
.skin-card:hover{ transform: translateY(-2px) }
.skin-card:hover .skin-frame-dark::before{ content:""; position:absolute; inset:-20% -10%; background: linear-gradient(95deg, rgba(255,255,255,0), rgba(255,255,255,0.4), rgba(255,255,255,0)); transform: translateX(-120%); animation: skin-sheen 360ms ease-out forwards }
@keyframes skin-sheen{ to { transform: translateX(120%) } }
[data-motion='reduce'] .skin-card{ transition: none }
[data-motion='reduce'] .skin-card:hover{ transform:none }
[data-motion='reduce'] .skin-card:hover .skin-frame-dark::before{ content:none }

/* ===================== SET PREVIEW (Catalog) ===================== */

/* Themed background inside preview panel only */
.preview-bg{ position:absolute; inset:0; border-radius:16px; z-index:0; pointer-events:none; overflow:hidden }
[data-theme="BASE"] .preview-bg{
  background:
    radial-gradient(60% 50% at 50% 30%, rgba(255,255,255,0.04), transparent 65%),
    repeating-linear-gradient(120deg, rgba(255,255,255,0.03) 0 1px, rgba(0,0,0,0) 1px 14px);
  opacity:.9;
}
[data-theme="APEX"] .preview-bg{
  background:
    radial-gradient(50% 40% at 65% 32%, rgba(120,90,255,0.10), transparent 55%),
    radial-gradient(40% 36% at 30% 66%, rgba(40,120,255,0.08), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,0.25), transparent 60%);
  animation: nebula-float 16s ease-in-out infinite;
}
[data-theme="NEO"] .preview-bg{
  background:
    repeating-linear-gradient(0deg, rgba(0,255,240,0.06) 0 1px, rgba(0,0,0,0) 1px 6px),
    linear-gradient(180deg, rgba(0,0,0,0.25), transparent 60%);
  animation: scan-shift 8s linear infinite;
}
@keyframes nebula-float { 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-8px) } }
@keyframes scan-shift { 0%{ background-position: 0 0, 0 0 } 100%{ background-position: 0 12px, 0 0 } }

[data-motion='reduce'] .preview-bg{ animation: none !important }
@media (prefers-reduced-motion: reduce){ .preview-bg{ animation: none !important } }

/* Divider separating odds and preview area */
.preview-divider{ height:1px; margin-top:14px; background: linear-gradient(90deg, rgba(255,255,255,0.04), rgba(255,255,255,0.12), rgba(255,255,255,0.04)); border-radius:9999px }

/* Odds chips (glass capsules with tier accents) */
.odd-chip{ @apply inline-flex items-center justify-center text-[11px] rounded-[14px];
  padding: 6px 10px; border: 1px solid rgba(255,255,255,0.16);
  background: linear-gradient(180deg, rgba(0,0,0,0.70), rgba(0,0,0,0.82));
  box-shadow: 0 6px 18px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08);
  backdrop-filter: blur(8px);
}
.odd-chip[data-tier='rare']{ background: linear-gradient(180deg, rgba(70,120,255,0.20), rgba(0,0,0,0.70)); border-color: rgba(130,170,255,0.35) }
.odd-chip[data-tier='secret']{ background: linear-gradient(180deg, rgba(255,120,220,0.22), rgba(0,0,0,0.70)); border-color: rgba(255,160,240,0.38) }
.odd-chip[data-tier='crown']{ background: linear-gradient(180deg, rgba(255,215,0,0.22), rgba(0,0,0,0.70)); border-color: rgba(255,215,0,0.42) }

/* Preview card halo */
.preview-card-frame{ box-shadow: 0 18px 48px rgba(0,0,0,0.45) }
.preview-halo{ position:absolute; inset:10% 10% 18% 10%; border-radius:22px; filter: blur(24px); opacity:.75; z-index:1; pointer-events:none }
[data-theme="BASE"] .preview-halo{ background: radial-gradient(60% 60% at 50% 40%, rgba(255,215,180,0.10), rgba(255,255,255,0.0) 65%) }
[data-theme="APEX"] .preview-halo{ background: radial-gradient(60% 60% at 50% 40%, rgba(115,95,255,0.18), rgba(255,255,255,0.0) 70%) }
[data-theme="NEO"] .preview-halo{ background: radial-gradient(60% 60% at 50% 40%, rgba(0,255,220,0.12), rgba(255,255,255,0.0) 70%) }

/* Soft fade-in for top grid */
.preview-fadein{ animation: preview-in 360ms cubic-bezier(0.4,0.0,0.2,1) both }
@keyframes preview-in{ from{ opacity:0; transform: translateY(8px) } to{ opacity:1; transform: translateY(0) } }
[data-motion='reduce'] .preview-fadein{ animation: none !important }

/* Carousel polish for preview */
.preview-rail .carousel-track{ will-change: transform }
.preview-rail .carousel-item{ transition: transform 80ms cubic-bezier(.4,0,.2,1), box-shadow 120ms ease; animation: rail-item-in 220ms cubic-bezier(.4,0,.2,1) both }
.preview-rail .carousel-item:hover{ transform: translateY(-2px) scale(1.02); box-shadow: 0 16px 36px rgba(0,0,0,0.45) }
.preview-rail .carousel-item::after{ content:''; position:absolute; inset:0; border-radius:14px; pointer-events:none; box-shadow: 0 0 0 1px rgba(255,255,255,0.06) }
.preview-rail .carousel::after{ content:''; position:absolute; inset:0; pointer-events:none; background: linear-gradient(90deg, rgba(0,0,0,0) 60%, rgba(0,0,0,0.24)); }
.preview-rail .carousel-item.is-active{ filter: brightness(1.04); animation: active-pulse 2200ms ease-in-out infinite }
@keyframes active-pulse { 0%,100% { filter: brightness(1.02) } 50% { filter: brightness(1.06) } }
@keyframes rail-item-in { from { opacity: 0; transform: translateY(6px) scale(.98) } to { opacity: 1; transform: translateY(0) scale(1) } }
.preview-rail .carousel-item:nth-child(1){ animation-delay: 40ms }
.preview-rail .carousel-item:nth-child(2){ animation-delay: 60ms }
.preview-rail .carousel-item:nth-child(3){ animation-delay: 80ms }
.preview-rail .carousel-item:nth-child(4){ animation-delay: 100ms }
.preview-rail .carousel-item:nth-child(5){ animation-delay: 120ms }
.preview-rail .carousel-item:nth-child(6){ animation-delay: 140ms }
.preview-rail .carousel-item:nth-child(7){ animation-delay: 160ms }
.preview-rail .carousel-item:nth-child(8){ animation-delay: 180ms }
.preview-rail .carousel-item:nth-child(9){ animation-delay: 200ms }
.preview-rail .carousel-item:nth-child(10){ animation-delay: 220ms }
[data-motion='reduce'] .preview-rail .carousel-item{ animation: none !important }

/* CTAs */
.cta-secondary{ @apply capsule-btn; }
.cta-primary{ @apply capsule-btn primary; box-shadow: 0 18px 48px rgba(0,0,0,0.45), 0 0 22px rgba(30,209,161,0.25) }


/* User-controlled reduced motion (independent of OS) */
[data-motion='reduce'] .card-discarding { animation: card-discard-reduced 280ms ease forwards !important; }
@keyframes card-discard-reduced { to { opacity: 0; } }
[data-motion='reduce'] .card-promoting { animation: none !important; }
[data-motion='reduce'] .glow-radial { animation: none; opacity: 0.2; }
[data-motion='reduce'] .particle { display: none; }
[data-motion='reduce'] .stack-rise, [data-motion='reduce'] .intro-scale { animation: none !important; }

/* Animated background outside the stage container */
.app-bg-animated { position: relative; background: #0B0D0F; overflow: hidden; }
.app-bg-animated::before, .app-bg-animated::after {
  content: '';
  position: absolute; inset: -20% -10% auto -10%; height: 60vh;
  background: radial-gradient(60% 60% at 30% 30%, rgba(30,209,161,0.06), rgba(30,209,161,0.0) 65%),
              radial-gradient(40% 40% at 70% 60%, rgba(100,150,255,0.04), rgba(100,150,255,0.0) 70%);
  filter: blur(10px);
  transform: translateY(0) scale(1);
  animation: app-bg-float 12s ease-in-out infinite;
  pointer-events: none;
}
.app-bg-animated::after {
  inset: auto -10% -20% -10%; height: 50vh;
  animation: app-bg-float-2 16s ease-in-out infinite;
}
@keyframes app-bg-float { 0%,100%{ transform: translateY(0) scale(1) } 50%{ transform: translateY(-10px) scale(1.02) } }
@keyframes app-bg-float-2 { 0%,100%{ transform: translateY(0) scale(1) } 50%{ transform: translateY(12px) scale(1.03) } }

@media (prefers-reduced-motion: reduce) {
  .app-bg-animated::before, .app-bg-animated::after { animation: none; }
}

/* ===================== Transition Overlay ===================== */
.t-overlay{ position: fixed; inset: 0; z-index: 60; pointer-events: none; overflow: hidden }
.t-overlay .t-backdrop{ position:absolute; inset:0; background: radial-gradient(80% 60% at 50% 40%, rgba(0,0,0,0.0), rgba(0,0,0,0.14)), rgba(0,0,0,0.0); transition: opacity var(--t-dur,700ms) ease }
.t-overlay .t-card{ position:absolute; top: 50%; left: 50%; width: 240px; height: 340px; border-radius: 18px; box-shadow: 0 24px 60px rgba(0,0,0,0.55); transform: translate(-50%,-50%) scale(1); opacity: 0; background: radial-gradient(60% 60% at 50% 40%, rgba(255,255,255,0.12), rgba(255,255,255,0)); filter: blur(0px) }
.t-overlay.t-playing .t-backdrop{ opacity: 1 }
.t-overlay.t-playing .t-card{ opacity: 1; animation: t-zoom var(--t-dur,700ms) ease-in-out forwards }
@keyframes t-zoom { 0%{ transform: translate(-50%,-50%) scale(1); filter: blur(0px); opacity: 0.0 } 40%{ opacity: 1 } 100%{ transform: translate(-50%,-50%) scale(1.2); filter: blur(10px); opacity: 0 } }
[data-motion='reduce'] .t-overlay .t-card{ animation: t-fade var(--t-dur,450ms) ease forwards }
@keyframes t-fade { from{ opacity: 0 } to{ opacity: 1 } }

/* Rim highlight on top-active card */
.top-active{ filter: drop-shadow(0 10px 28px rgba(0,0,0,.55)) }
.top-active::before{ content:""; position:absolute; inset:-10px; border-radius:18px; background: radial-gradient(60% 60% at 50% 40%, rgba(255,255,255,.08), transparent 60%); pointer-events:none }

.card-3d {
  transform-style: preserve-3d;
  perspective: 1200px;
}

.card-face {
  backface-visibility: hidden;
}

.card-face.back {
  transform: rotateY(180deg);
}

/* Premium gradient borders with subtle glow */
.gradient-border {
  position: relative;
  --frame-a: #00e5ff;
  --frame-b: #b388ff;
  background: linear-gradient(135deg, var(--frame-a), var(--frame-b));
  padding: 2px;
  box-shadow: 
    0 0 12px rgba(0,0,0,0.35),
    inset 0 0 8px rgba(255,255,255,0.08);
}
.gradient-border .inner {
  background: rgba(12,12,12,0.9);
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
}
.gradient-border::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.12), transparent 40%);
  pointer-events: none;
}

.simple-border {
  position: relative;
  border: 1px solid var(--frame-a, #6b7280);
  box-shadow: 
    0 0 8px rgba(0,0,0,0.30),
    inset 0 1px 0 rgba(255,255,255,0.06);
}

/* Foil sheen sweep */
.foil-sheen { position: relative; overflow: hidden; }
.foil-sheen .sheen {
  content: '';
  position: absolute;
  inset: -50% -50%;
  background: conic-gradient(from 180deg at 50% 50%, rgba(255,255,255,0.0), rgba(255,255,255,0.15), rgba(255,255,255,0.0) 30%);
  transform: rotate(25deg);
  pointer-events: none;
}
@keyframes sheen-move {
  0% { transform: translateX(-30%) rotate(25deg); }
  50% { transform: translateX(30%) rotate(25deg); }
  100% { transform: translateX(100%) rotate(25deg); }
}

/* Premium badges with refined contrast */
.badge {
  @apply inline-flex items-center justify-center text-[10px] rounded-[14px];
  padding: 6px 10px; /* inner padding: 6â€“10 for optical balance */
  border: 1px solid rgba(255,255,255,0.18);
  background: linear-gradient(180deg, rgba(0,0,0,0.75), rgba(0,0,0,0.85));
  box-shadow: 
    0 2px 6px rgba(0,0,0,0.35),
    inset 0 0.5px 0 rgba(255,255,255,0.12);
  backdrop-filter: blur(8px);
}

/* Set pill: small-caps, premium finish */
.set-pill {
  @apply inline-flex items-center justify-center rounded-[14px] text-[10px] tracking-wide;
  padding: 6px 10px; /* inner padding */
  font-variant: small-caps;
  letter-spacing: .04em;
  border: 1px solid rgba(255,255,255,0.16);
  background: linear-gradient(180deg, rgba(0,0,0,0.82), rgba(0,0,0,0.92));
  box-shadow: 
    0 2px 6px rgba(0,0,0,0.35),
    inset 0 0.5px 0 rgba(255,255,255,0.10);
  backdrop-filter: blur(10px);
}

/* Hover sweep and elevation (GPU-friendly) */
.hover-sweep { position: relative; overflow: hidden; }
.hover-sweep::before {
  content: '';
  position: absolute; inset: 0; pointer-events: none;
  background: linear-gradient(100deg, rgba(255,255,255,0), rgba(255,255,255,0.07), rgba(255,255,255,0));
  transform: translateX(-120%);
  opacity: 1; will-change: transform;
}
.hover-sweep:hover::before { animation: sweep-once 800ms ease forwards; }
@keyframes sweep-once { to { transform: translateX(120%); } }

.elevate-hover { 
  transition: transform 280ms cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 280ms cubic-bezier(0.34, 1.56, 0.64, 1); 
  will-change: transform; 
}
.elevate-hover:hover { 
  transform: scale(1.06) translateY(-2px); 
  box-shadow: 
    0 24px 48px rgba(0,0,0,0.40), 
    0 0 16px rgba(255,255,255,0.08);
}
.elevate-hover:active { 
  transform: scale(1.03) translateY(-1px); 
  box-shadow: 
    0 14px 28px rgba(0,0,0,0.35),
    0 0 8px rgba(255,255,255,0.06);
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .foil-sheen .sheen, .hover-sweep::before, .flip-in, .shiny-sweep::after, .reveal-pop, .tear-strip .tear-foil { animation: none !important; }
  .elevate-hover, .elevate-hover:hover, .elevate-hover:active { transition: none !important; transform: none !important; }
}

/* Premium shiny diagonal sweep with iridescence */
.shiny-sweep::after {
  content: '';
  position: absolute;
  left: -50%;
  top: -50%;
  width: 200%;
  height: 200%;
  background: 
    linear-gradient(62deg, 
      rgba(255,255,255,0) 38%, 
      rgba(255,180,220,0.18) 44%,
      rgba(255,255,255,0.32) 50%, 
      rgba(180,220,255,0.18) 56%,
      rgba(255,255,255,0) 62%);
  transform: rotate(12deg);
  animation: shiny-wipe 2.6s cubic-bezier(0.45, 0.05, 0.55, 0.95) infinite;
  mix-blend-mode: screen;
  pointer-events: none;
}
@keyframes shiny-wipe {
  0% { transform: translateX(-32%) rotate(12deg); }
  50% { transform: translateX(8%) rotate(12deg); }
  100% { transform: translateX(32%) rotate(12deg); }
}

/* Flip/scale helper for top card */
.flip-in {
  animation: flip-in-anim 350ms ease both;
}
@keyframes flip-in-anim {
  0% { transform: scale(0.98) rotateX(4deg); opacity: 0.0; }
  100% { transform: scale(1) rotateX(0deg); opacity: 1; }
}

/* Single-pass sheen for pack */
.sheen-once { animation: sheen-move 820ms linear; }

/* Fade-up cascade for catalog items */
.fade-up { transform: translateY(12px) scale(0.98); animation: fade-up 400ms ease forwards; }
@keyframes fade-up { to { transform: translateY(0) scale(1); } }

/* Reveal pop for card */
.reveal-pop { animation: reveal-pop 220ms ease-out both; }
@keyframes reveal-pop { 0% { transform: scale(0.98); } 100% { transform: scale(1); } }

/* Sparkle burst (small) */
.sparkle-burst {
  position: relative;
}
.sparkle-burst::after {
  content: '';
  position: absolute; inset: 0; pointer-events: none;
  background:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,0.22), transparent 30%),
    radial-gradient(circle at 70% 40%, rgba(255,255,255,0.18), transparent 28%),
    radial-gradient(circle at 40% 70%, rgba(255,255,255,0.16), transparent 26%);
  animation: sparkle-drift 480ms ease-out forwards;
}
@keyframes sparkle-drift { from { transform: translateY(0) scale(1); } to { transform: translateY(-8px) scale(1.1); } }

/* Foil texture overlay (subtle noise streaks) */
.foil-texture::before {
  content: '';
  position: absolute; inset: 0; pointer-events: none;
  background-image: linear-gradient(12deg, rgba(255,255,255,0.03) 8%, rgba(255,255,255,0) 8%), linear-gradient(192deg, rgba(255,255,255,0.02) 6%, rgba(255,255,255,0) 6%);
}

.foil-prism { position: relative; }
.foil-prism::after {
  content: '';
  position: absolute; inset: 0; pointer-events: none;
  mix-blend-mode: screen;
  opacity: var(--foil-intensity, 0.4);
  background-image:
    repeating-linear-gradient(var(--foil-angle, 45deg), rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 8%, rgba(255,255,255,0.05) 16%),
    conic-gradient(from 0deg at var(--foil-x, 50%) var(--foil-y, 50%), rgba(255,0,0,0.08), rgba(255,255,0,0.08), rgba(0,255,0,0.08), rgba(0,255,255,0.08), rgba(0,0,255,0.08), rgba(255,0,255,0.08), rgba(255,0,0,0.08)),
    radial-gradient(circle at var(--foil-x, 50%) var(--foil-y, 50%), rgba(255,255,255,0.20), rgba(255,255,255,0) 60%);
}

/* Legacy discard - kept for compatibility */
.discard-anim {
  animation: discard-out 240ms ease forwards;
}
@keyframes discard-out {
  to { transform: translateX(-200px) translateY(-120px) rotateZ(-15deg); opacity: 0; }
}

/* Dust particles */
.dust { position: absolute; width: 6px; height: 6px; border-radius: 9999px; pointer-events: none; opacity: 0.9; }
@keyframes dust-burst { from { transform: translate(0,0) scale(1); opacity: 0.9; } to { transform: translate(var(--dx), var(--dy)) scale(0.6); opacity: 0; } }

/* Promote next top card: quick lift/settle */
.promote-lift { animation: promote-lift 180ms cubic-bezier(.2,.8,.2,1) both; }
@keyframes promote-lift { 0%{ transform: translateY(-10px) scale(1.02); } 100%{ transform: translateY(0) scale(1); } }

/* Pulse highlight (once) */
.pulse-once { animation: pulse 900ms ease-out; }
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0,229,255,0.0); } 50% { box-shadow: 0 0 0 8px rgba(0,229,255,0.18); } 100% { box-shadow: 0 0 0 0 rgba(0,229,255,0.0); } }

/* Small pack shake */
.pack-shake { animation: pack-shake 120ms ease-in-out 2; }
@keyframes pack-shake { 0% { transform: translateX(0); } 25% { transform: translateX(-6px); } 50% { transform: translateX(6px); } 75% { transform: translateX(-3px); } 100% { transform: translateX(0); } }

/* Fan lift for stacked cards/* Stack gentle rise on intro */
.stack-rise{ animation: stack-rise 180ms ease-out both }
@keyframes stack-rise{ from{ transform: translateY(8px) scale(.985) } to{ transform: translateY(0) scale(1) } }

/* ===== PackRip overlay (prelude) ===== */
.pack-rip{ position:absolute; inset:0; z-index:5; display:flex; flex-direction:column; align-items:center; justify-content:center; pointer-events:auto }
.pack-rip .pack-wrap{ position:relative; width:240px; height:340px; border-radius:18px; box-shadow: 0 20px 40px rgba(0,0,0,.45); background: #101418; overflow:hidden; cursor: grab; transform: translateZ(0); animation: pack-breath 1600ms ease-in-out infinite alternate; }
.pack-rip.dragging .pack-wrap{ cursor: grabbing; animation: none }
@keyframes pack-breath { from{ transform: translateZ(0) scale(1) } to{ transform: translateZ(0) scale(1.02) } }
.pack-rip .pack-foil{ position:absolute; inset:0; border-radius:inherit; background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,0) 30%), var(--foil-bg, radial-gradient(60% 60% at 50% 40%, rgba(255,215,0,.18), rgba(0,0,0,0) 70%)); filter: saturate(120%); }
[data-theme="BASE"] .pack-rip{ --foil-bg: radial-gradient(60% 60% at 50% 40%, rgba(255,215,0,.20), rgba(0,0,0,0) 70%) }
[data-theme="APEX"] .pack-rip{ --foil-bg: radial-gradient(60% 60% at 50% 40%, rgba(140,110,255,.22), rgba(0,0,0,0) 70%) }
[data-theme="NEO"] .pack-rip{ --foil-bg: radial-gradient(60% 60% at 50% 40%, rgba(0,255,220,.20), rgba(0,0,0,0) 70%) }
.pack-rip .foil-shimmer{ position:absolute; inset:-10% -40%; background: linear-gradient(100deg, transparent 40%, rgba(255,255,255,.18) 50%, transparent 60%); filter: blur(10px); transform: translateX(-40%); animation: sweep-once 900ms ease-out infinite; opacity:.6 }
.pack-rip .pack-logo{ position:absolute; inset:0; background: radial-gradient(30% 30% at 30% 28%, rgba(255,255,255,.06), transparent 60%), radial-gradient(22% 22% at 70% 62%, rgba(255,255,255,.04), transparent 62%); mix-blend-mode: screen; opacity:.8 }
.pack-rip .pack-cta{ margin-top: 12px; font-size: 14px; color: rgba(255,255,255,.85) }

/* Halves appear during ripping */
.pack-rip .pack-half{ position:absolute; top:0; bottom:0; width:52%; background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.02)); box-shadow: inset 0 0 0 1px rgba(255,255,255,.14); opacity:0; }
.pack-rip .pack-half.left{ left:0; border-top-left-radius:18px; border-bottom-left-radius:18px; transform-origin: right center; }
.pack-rip .pack-half.right{ right:0; border-top-right-radius:18px; border-bottom-right-radius:18px; transform-origin: left center; }
.pack-rip .rip-seam{ position:absolute; left:50%; top:0; bottom:0; width:2px; transform: translateX(-1px); background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.3)); mix-blend-mode: screen; opacity:.2 }
.pack-rip .rip-burst{ position:absolute; inset:-20%; pointer-events:none; border-radius:22px; background: radial-gradient(circle at 50% 50%, rgba(255,255,255,.35), rgba(255,255,255,0) 60%); opacity:0; filter: blur(10px) }

/* Drag-progress driven transforms */
.pack-rip.dragging .pack-half.left{ opacity: calc(.2 + var(--rip,0)*.8); transform: translateX(calc(var(--rip,0) * -120px)) rotateY(calc(var(--rip,0) * -30deg)) }
.pack-rip.dragging .pack-half.right{ opacity: calc(.2 + var(--rip,0)*.8); transform: translateX(calc(var(--rip,0) *  120px)) rotateY(calc(var(--rip,0) *  30deg)) }
.pack-rip.dragging .rip-seam{ opacity: calc(.2 + var(--rip,0) * .6) }

.pack-rip.ripping .pack-half{ opacity:1 }
.pack-rip.ripping .pack-half.left{ animation: rip-left 420ms cubic-bezier(.15,.8,.2,1) forwards }
.pack-rip.ripping .pack-half.right{ animation: rip-right 420ms cubic-bezier(.15,.8,.2,1) forwards }
.pack-rip.ripping .rip-burst{ animation: rip-burst 220ms ease-out forwards 180ms }
.pack-rip.revealing .pack-wrap{ animation: pack-fade 150ms ease forwards 300ms }
@keyframes rip-left { 0%{ transform: rotateY(0) translateX(0); } 60%{ transform: rotateY(-22deg) translateX(-4px) } 100%{ transform: rotateY(-35deg) translateX(-140px); opacity: 0 } }
@keyframes rip-right{ 0%{ transform: rotateY(0) translateX(0); } 60%{ transform: rotateY(22deg) translateX(4px) } 100%{ transform: rotateY(35deg) translateX(140px); opacity: 0 } }
@keyframes rip-burst{ 0%{ opacity:.0; transform: scale(.8) } 100%{ opacity:0; transform: scale(1.2) } }
@keyframes pack-fade{ to { opacity: 0; transform: scale(1.02) } }

/* Stack pre-reveal fades behind PackRip, then appears */
.card-stack-3d.stack-pre{ opacity: 0; transform: translateY(10px) scale(.98) }

/* Neutral card skeleton used while WebGL prewarms */
.card-skeleton{ position: relative; border-radius: 14px; overflow: hidden; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); box-shadow: 0 14px 32px rgba(0,0,0,0.45), inset 0 0 0 1px rgba(255,255,255,0.08); }
.card-skeleton::before{ content:""; position:absolute; inset:0; background: repeating-linear-gradient(135deg, rgba(255,255,255,0.04) 0 2px, rgba(0,0,0,0) 2px 10px); opacity:.8 }
.card-skeleton::after{ content:""; position:absolute; inset:0; background: radial-gradient(circle at 50% 40%, rgba(255,255,255,0.08), rgba(255,255,255,0) 60%); mix-blend-mode: screen; opacity:.6 }

/* Tiny on-screen debug HUD */
.debug-hud{ position: fixed; left: 12px; bottom: 12px; z-index: 60; padding: 6px 8px; font: 12px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; color:#cbd5e1; border-radius: 8px; background: rgba(2,6,12,0.6); border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 10px 24px rgba(0,0,0,0.35); }

/* Debug outline around active renderer layer */
.renderer-outline{ outline: 1px dashed rgba(34,197,94,0.8); outline-offset: 2px; }

/* ===== Programmatic Card (CSS/SVG renderer) ===== */
.prog-card{ position: relative; border-radius:14px; overflow:hidden; box-shadow: 0 16px 36px rgba(0,0,0,0.45); transform-style: preserve-3d; will-change: transform, filter; transition: transform 120ms ease, filter 120ms ease; }
.prog-card > *{ pointer-events:none }
.prog-base{ position:absolute; inset:0; background:
  radial-gradient(80% 60% at 50% 35%, rgba(255,255,255,0.10), rgba(255,255,255,0.00) 70%),
  conic-gradient(from var(--g-angle, 20deg) at 50% 50%, rgba(255,255,255,0.04), rgba(0,0,0,0) 80%);
  filter: saturate(110%);
}
.prog-noise{ position:absolute; inset:0; opacity:.06; background:
  repeating-linear-gradient(0deg, rgba(255,255,255,0.06) 0 1px, rgba(0,0,0,0) 1px 3px),
  repeating-linear-gradient(90deg, rgba(255,255,255,0.04) 0 1px, rgba(0,0,0,0) 1px 4px);
}
.prog-vignette{ position:absolute; inset:0; background: radial-gradient(120% 100% at 50% 40%, rgba(0,0,0,0.0), rgba(0,0,0,0.38)); }

/* Metal frame ring using content-box mask */
.prog-metal{ position:absolute; inset:0; padding:2px; border-radius:14px; background: linear-gradient(135deg, var(--metal-a, #e5e7eb), var(--metal-b, #6b7280));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
}
.prog-frame{ position:absolute; inset:2px; border-radius:12px; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.20); }
.prog-rim{ position:absolute; left:2px; right:2px; top:2px; height:16px; border-top-left-radius:12px; border-top-right-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,0.22), rgba(255,255,255,0.00)); opacity:.45 }
.prog-gloss{ position:absolute; inset:-30% -20% -40% -20%; background: linear-gradient(var(--gloss-angle, 30deg), rgba(255,255,255,0.12), rgba(255,255,255,0.00) 40%, rgba(255,255,255,0.10) 60%, rgba(255,255,255,0.00)); mix-blend-mode: screen; opacity:.12 }

/* CSS foil that degrades from WebGL shimmer; intensity via --foil-i and hue sweep angle via --foil-angle */
.prog-foil{ position:absolute; inset:0; border-radius:inherit; mix-blend-mode: screen; opacity: calc(var(--foil-i, 0.2)); background:
  conic-gradient(from var(--foil-angle, 0deg) at 50% 50%, rgba(255,255,255,0.0), rgba(255,255,255,0.26), rgba(255,255,255,0.0) 40%),
  repeating-linear-gradient(45deg, rgba(255,255,255,0.08) 0 1px, rgba(0,0,0,0) 1px 6px);
  background-blend-mode: screen, normal;
  filter: saturate(130%);
}
.prog-foil.is-active{ animation: foil-flow 6s linear infinite; }
@keyframes foil-flow{ 0%{ background-position: 0 0, 0 0 } 100%{ background-position: 0 0, 120px 0 } }
[data-motion='reduce'] .prog-foil.is-active{ animation: none }

/* Parallax layers for 3D feel (translation based on --dx/--dy from pointer) */
.parallax-1{ transform: translate(calc(var(--dx, 0) * -4px),  calc(var(--dy, 0) * -4px)); will-change: transform; }
.parallax-2{ transform: translate(calc(var(--dx, 0) * -8px),  calc(var(--dy, 0) * -8px)); will-change: transform; }
.parallax-3{ transform: translate(calc(var(--dx, 0) * -12px), calc(var(--dy, 0) * -12px)); will-change: transform; }
.parallax-4{ transform: translate(calc(var(--dx, 0) * -16px), calc(var(--dy, 0) * -16px)); will-change: transform; }
[data-motion='reduce'] .parallax-1, [data-motion='reduce'] .parallax-2, [data-motion='reduce'] .parallax-3, [data-motion='reduce'] .parallax-4{ transform: none !important }

.prog-ui{ position:absolute; inset:0; padding:10px; border-radius:10px; display:flex; flex-direction:column; justify-content:flex-end; color:#e6e6e6; text-shadow: 0 1px 0 rgba(0,0,0,0.6); }
.prog-ui .title-row{ display:flex; align-items:baseline; justify-content:space-between; gap:8px; margin-bottom:4px }
.prog-ui .title{ font-weight:600; font-size:14px; letter-spacing:.01em; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.prog-ui .number{ font-size:10px; opacity:.75 }
.prog-ui .meta-row{ display:flex; gap:6px }
.prog-ui .set-pill{ font-size:10px; padding:4px 8px; border-radius:9999px; background: rgba(0,0,0,0.55); border: 1px solid rgba(255,255,255,0.12) }
.prog-ui .rarity-pill{ font-size:10px; padding:4px 8px; border-radius:9999px; background: rgba(0,0,0,0.45); border: 1px solid rgba(255,255,255,0.16) }

/* Cursor-follow specular highlight used in both CSS and WebGL renderers */
.specular-overlay{
  position:absolute; inset:0; pointer-events:none; border-radius:inherit; mix-blend-mode: screen;
  background:
    radial-gradient(120px 100px at var(--mx,50%) var(--my,50%), rgba(255,255,255,0.35), rgba(255,255,255,0.00) 60%),
    radial-gradient(260px 200px at var(--mx,50%) calc(var(--my,50%) + 12%), rgba(255,255,255,0.08), rgba(255,255,255,0) 70%);
  opacity: var(--specular-o, 0.28);
  transition: background-position 80ms ease-out, opacity 120ms ease-out;
}

/* Rip particles (foil confetti) */
.rip-particles{ position:absolute; inset:0; pointer-events:none; overflow:hidden; }
.foil-piece{ position:absolute; left:50%; top:50%; background: hsl(var(--hue,48) 80% 70%); opacity:.95; transform: translate(-50%,-50%); border-radius: 1px; filter: saturate(120%); animation: rip-piece 620ms ease-out forwards; animation-delay: var(--delay, 0ms) }
@keyframes rip-piece { 
  0% { transform: translate(-50%,-50%) translate(0,0) rotate(0deg); opacity:.95 }
  80% { transform: translate(-50%,-50%) translate(var(--vx,40px), var(--vy,-60px)) rotate(220deg); opacity:.35 }
  100%{ transform: translate(-50%,-50%) translate(calc(var(--vx,40px) * 1.1), calc(var(--vy,-60px) * 1.1)) rotate(300deg); opacity:0 }
}

/* Stage glow spike during rip */
.stage-canvas.rip-boost{ filter: brightness(1.06); }
.stage-canvas.rip-boost .stage-glow .glow-radial{ transform: translate(-50%, -50%) scale(1.08); opacity:.98 }

/* Subtle foil shimmer on high rarities (top-active only) */
.card-stack-item.top-active[data-rank="8"] .card-scale::after,
.card-stack-item.top-active[data-rank="9"] .card-scale::after,
.card-stack-item.top-active[data-rank="10"] .card-scale::after{
  content:''; position:absolute; inset:-12%; pointer-events:none; mix-blend-mode:screen; opacity:.42;
  background: linear-gradient(110deg, rgba(255,255,255,0.0) 35%, rgba(255,255,255,0.22) 50%, rgba(255,255,255,0.0) 65%);
  animation: foil-sheen 1200ms cubic-bezier(.25,.46,.45,.94) infinite;
}
@keyframes foil-sheen{ from{ transform: translateX(-120%) } to{ transform: translateX(120%) } }
[data-motion='reduce'] .card-stack-item.top-active .card-scale::after{ display:none }

/* Reduced motion: quick crossfade */
[data-motion='reduce'] .pack-rip .foil-shimmer{ display:none }
[data-motion='reduce'] .pack-rip .pack-half, [data-motion='reduce'] .pack-rip .rip-seam, [data-motion='reduce'] .pack-rip .rip-burst{ display:none }
[data-motion='reduce'] .rip-particles{ display:none }
[data-motion='reduce'] .pack-rip.revealing .pack-wrap{ animation: pack-fade 220ms ease forwards 120ms }

/* ===== Pack Summary Scene ===== */
#summary-stage { padding: 24px; }
.summary-canvas { position: relative; min-height: calc(100vh - 48px); border-radius: 16px; overflow: hidden; }
.summary-canvas .stage-panel { position: relative; margin: 0 auto; max-width: 1100px; padding: 28px 24px 32px; border-radius: 16px; background: rgba(17,19,23,0.65); border: 1px solid rgba(75,85,99,0.35); backdrop-filter: blur(10px); box-shadow: 0 20px 50px rgba(0,0,0,0.35); }
.summary-ambient { position:absolute; inset:0; background: radial-gradient(80% 60% at 50% 30%, rgba(255,255,255,0.06), transparent 70%), linear-gradient(180deg, rgba(10,12,15,0.9), rgba(10,12,15,0.95)); filter: saturate(110%); }
[data-theme="BASE"] .summary-ambient{ background: radial-gradient(80% 60% at 50% 30%, rgba(255,215,0,0.08), transparent 70%), linear-gradient(180deg, rgba(10,12,15,0.9), rgba(10,12,15,0.95)); }
[data-theme="APEX"] .summary-ambient{ background: radial-gradient(80% 60% at 50% 30%, rgba(165,110,255,0.10), transparent 70%), linear-gradient(180deg, rgba(10,12,15,0.9), rgba(10,12,15,0.95)); }
[data-theme="NEO"] .summary-ambient{ background: radial-gradient(80% 60% at 50% 30%, rgba(0,255,220,0.08), transparent 70%), linear-gradient(180deg, rgba(10,12,15,0.9), rgba(10,12,15,0.95)); }

.summary-particles{ position:absolute; inset:0; pointer-events:none; overflow:hidden }
.summary-particles .speck{ position:absolute; left: calc(5% + (var(--i)*6%)); bottom:-10%; width:2px; height:10px; border-radius:1px; opacity:.18; background: #e6eaee; animation: speck-float 6s linear infinite; animation-delay: var(--d, 0s); filter: blur(.3px) }
@keyframes speck-float{ 0%{ transform: translateY(0) } 100%{ transform: translateY(-120vh) } }

.summary-header{ display:flex; flex-direction:column; gap:4px; align-items:flex-start; padding: 4px 2px 12px }
.summary-eyebrow{ font-size:12px; letter-spacing:.12em; text-transform:uppercase; opacity:.7 }
.summary-title{ font-size:22px; font-weight:600; opacity:0; transform: translateY(8px); animation: sum-title-in 420ms cubic-bezier(.2,.8,.2,1) forwards 100ms }
.summary-sub{ font-size:14px; opacity:.8 }
@keyframes sum-title-in{ to { opacity:1; transform: translateY(0) } }

.summary-grid{ margin-top: 14px; display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px }
.summary-card{ width:180px; height:252px; margin: 0 auto; opacity:0; transform: translateY(12px) rotateX(8deg); transform-origin: center bottom; animation: sum-card-in 520ms cubic-bezier(.2,.8,.2,1) forwards }
.summary-card.is-rare{ transform: translateY(6px) rotateX(6deg) scale(1.04) }
@keyframes sum-card-in{ 0%{ opacity:0; transform: translateY(16px) rotateX(10deg) } 70%{ opacity:1; transform: translateY(-2px) rotateX(0deg) } 100%{ opacity:1; transform: translateY(0) rotateX(0deg) } }

.summary-stats{ margin-top: 18px; font-size:15px; opacity:.85 }
.summary-stats-line{ padding: 8px 4px; border-top: 1px solid rgba(75,85,99,0.35); }

.summary-actions{ margin-top: 18px; display:flex; gap:10px; justify-content:flex-end }

/* Summary canvas subtle scene phases */
.summary-canvas.opening .summary-ambient{ filter: brightness(1.04) }
.summary-canvas.summaryIntro .summary-ambient{ filter: brightness(1.0) }
.summary-canvas.summaryReady .summary-ambient{ filter: brightness(0.98) }

/* Reduced motion variant */
[data-motion='reduce'] .summary-card{ animation: sum-card-fade 280ms ease-out forwards !important; transform: none }
@keyframes sum-card-fade{ from{ opacity:0; transform: translateY(6px) } to { opacity:1; transform: translateY(0) } }
[data-motion='reduce'] .summary-title{ animation: sum-title-in 220ms ease-out forwards 40ms }
[data-motion='reduce'] .summary-particles{ display:none }

/* ===== Site-wide Animated Background (reuses summary ambient/particles) ===== */
.app-bg-animated{ position: relative; }
.app-bg-animated .bg-layers{ position: fixed; inset: 0; z-index: 0; pointer-events: none; }
.app-bg-animated header, .app-bg-animated .route-root{ position: relative; z-index: 1; }
.site-ambient{ position:absolute; inset:0; background: radial-gradient(80% 60% at 50% 30%, rgba(255,255,255,0.05), transparent 70%), linear-gradient(180deg, rgba(10,12,15,0.9), rgba(10,12,15,0.95)); filter: saturate(110%); }
[data-theme="BASE"] .site-ambient{ background: radial-gradient(80% 60% at 50% 30%, rgba(255,215,0,0.07), transparent 70%), linear-gradient(180deg, rgba(10,12,15,0.9), rgba(10,12,15,0.95)); }
[data-theme="APEX"] .site-ambient{ background: radial-gradient(80% 60% at 50% 30%, rgba(165,110,255,0.09), transparent 70%), linear-gradient(180deg, rgba(10,12,15,0.9), rgba(10,12,15,0.95)); }
[data-theme="NEO"] .site-ambient{ background: radial-gradient(80% 60% at 50% 30%, rgba(0,255,220,0.07), transparent 70%), linear-gradient(180deg, rgba(10,12,15,0.9), rgba(10,12,15,0.95)); }
.site-particles{ position:absolute; inset:0; pointer-events:none; overflow:hidden }
.site-particles .speck{ position:absolute; left: calc(2% + (var(--i)*4%)); bottom:-10%; width:2px; height:10px; border-radius:1px; opacity:.16; background: #e6eaee; animation: speck-float 8s linear infinite; animation-delay: var(--d, 0s); filter: blur(.4px) }
[data-motion='reduce'] .site-particles{ display:none }

/* Premium reveal VFX per rarity - smooth cubic-bezier timing */
.fx-holo-shimmer::after { content:''; position:absolute; inset:-20%; background: linear-gradient(120deg, rgba(255,255,255,0.18), rgba(255,255,255,0) 40%); transform: translateX(-120%); animation: fx-holo 1100ms cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; mix-blend-mode: screen; pointer-events:none; }
@keyframes fx-holo { to { transform: translateX(120%); } }

/* 3D wrapper with thickness + metallic rim */
.pack-wrapper {
  position: relative;
  border-radius: 22px;
  background: radial-gradient(120% 100% at 70% 30%, #1c1226 0%, #0c0c0f 60%, #070707 100%);
  box-shadow: 0 18px 38px rgba(0,0,0,.45);
  perspective: 1200px;
  transform-style: preserve-3d;
  will-change: transform;
}
.pack-wrapper::before {
  content: "";
  position: absolute; inset: 6px -6px -6px 6px; border-radius: 18px;
  background: linear-gradient(90deg, rgba(255,255,255,.15), rgba(255,255,255,0));
  filter: blur(.3px); transform: translateZ(-6px);
}
.pack-wrapper::after {
  content: ""; position: absolute; inset: 0; border-radius: 22px; padding: 1px;
  background: linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,.08));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  transform: translateZ(2px);
}
.pack-wrapper:hover { transform: rotateX(-3deg) rotateY(4deg); }

.tear-strip { position: relative; overflow: hidden; }
.tear-strip .tear-foil { position: absolute; inset: -40% -60%; background: linear-gradient(90deg, rgba(255,255,255,0.35), rgba(255,255,255,0) 45%, rgba(255,255,255,0.35) 55%); mix-blend-mode: screen; animation: tear-sweep 900ms linear infinite; }
@keyframes tear-sweep { from { transform: translateX(-40%); } to { transform: translateX(40%); } }

/* Capsule buttons (3D, rounded) */
.capsule-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .35rem;
  padding: .5rem .9rem;
  border-radius: 9999px;
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.02));
  border: 1px solid rgba(255,255,255,.12);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.10), 0 6px 18px rgba(0,0,0,.35);
  color: #e8e8e8;
  transition: transform 120ms ease, box-shadow 120ms ease, background 120ms ease;
}
.capsule-btn:hover { transform: translateY(-2px); background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.05)); }
.capsule-btn:active { transform: translateY(-1px); box-shadow: inset 0 1px 0 rgba(255,255,255,.12), 0 4px 12px rgba(0,0,0,.35); }
.capsule-btn.primary { background: linear-gradient(180deg, rgba(34,197,94,.28), rgba(20,184,166,.18)); border-color: rgba(45,212,191,.45); }
.capsule-btn.primary:hover { background: linear-gradient(180deg, rgba(34,197,94,.38), rgba(20,184,166,.26)); }
.capsule-btn.is-active { box-shadow: inset 0 2px 0 rgba(255,255,255,.16), 0 8px 22px rgba(0,0,0,.45); }
.capsule-btn:focus { outline: none; box-shadow: 0 0 0 2px rgba(34,197,94,.35), 0 0 0 6px rgba(34,197,94,.18); }

/* Soft pulse utility */
@keyframes pulse-soft { 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-1px) } }
.pulse-soft { animation: pulse-soft 1.6s ease-in-out infinite; }

/* Route transitions */

.route-root { will-change: opacity, transform; }
.route-fade { animation: route-fade-in 160ms ease both; transform: translateZ(10px); }
@keyframes route-fade-in { from { opacity: 0; transform: translateZ(10px); } to { opacity: 1; transform: translateZ(0); } }

/* Route exit (fade out + slight depth) */
.route-exit { animation: route-fade-out 160ms ease both; }
@keyframes route-fade-out { from { opacity: 1; transform: translateZ(0); } to { opacity: 0; transform: translateZ(-10px); } }

/* Soft landing ambiance */
.soft-landing { position: relative; }
.soft-landing::before {
  content: '';
  position: absolute;
  inset: -10% -10% auto -10%;
  height: 260px;
  background: radial-gradient(ellipse at 50% 0%, rgba(34,197,94,0.12), rgba(34,197,94,0.0) 60%);
  filter: blur(10px);
  pointer-events: none;
  animation: breathe 3800ms ease-in-out infinite;
}
@keyframes breathe { 0%,100%{ opacity: .55; } 50%{ opacity: .85; } }

/* Modal slide-up */
.modal-panel { animation: modal-up 320ms cubic-bezier(.2,.8,.2,1) both; }
@keyframes modal-up { from { opacity: 0; transform: translateY(24px) scale(.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

@media (prefers-reduced-motion: reduce) {
  .route-fade, .route-exit, .modal-panel { animation: none !important; transform: none !important; }
}

/* Flip-Y reveal for staged card */
.flip-y { animation: flip-y-anim 480ms cubic-bezier(.2,.8,.2,1) both; transform-style: preserve-3d; }
@keyframes flip-y-anim {
  0% { transform: rotateY(-90deg) scale(.98); opacity: 0; }
  100% { transform: rotateY(0deg) scale(1); opacity: 1; }
}

@media (prefers-reduced-motion: reduce) {
  .flip-y { animation: none !important; transform: none !important; }
}

/* Summary cascade-in */
.summary-card-in { animation: summary-in 260ms cubic-bezier(.2,.8,.2,1) both; }
@keyframes summary-in { from { opacity: 0; transform: translateY(12px) scale(.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

/* Best spotlight (subtle) */
.best-spotlight { position: relative; }
.best-spotlight::before { content:''; position:absolute; inset:-6% -6% -6% -6%; pointer-events:none; background: radial-gradient(circle at 50% 40%, rgba(255,255,255,0.10), rgba(255,255,255,0)); filter: blur(8px); }

.glass-panel{position:relative;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,rgba(22,22,26,.82),rgba(16,16,18,.78));box-shadow:0 30px 60px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);backdrop-filter:blur(16px) saturate(140%);-webkit-backdrop-filter:blur(16px) saturate(140%)}
.glass-frame{position:relative;padding:2px;border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,.28),rgba(255,255,255,.10))}
.glass-pill{display:inline-flex;align-items:center;justify-content:center;min-width:110px;padding:.16rem .68rem;border-radius:9999px;background:linear-gradient(180deg,rgba(255,255,255,.14),rgba(255,255,255,.04));border:1px solid rgba(255,255,255,.18);box-shadow:inset 0 1px 0 rgba(255,255,255,.12),0 6px 18px rgba(0,0,0,.35);color:#e9eef2;line-height:1}
.glass-pill::after{content:"";position:absolute;inset:0;border-radius:9999px;padding:1px;background:linear-gradient(90deg,var(--frame-a,#00e5ff),rgba(255,255,255,0));-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;opacity:.6}
.glass-rail{position:relative;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.10);box-shadow:inset 0 1px 0 rgba(255,255,255,.08),0 12px 28px rgba(0,0,0,.40);padding:10px 0;overflow:hidden}
.carousel{position:relative;overflow:hidden}
.carousel-track{display:inline-flex;gap:14px;will-change:transform}
.carousel-item{position:relative;width:120px;height:168px;border-radius:14px;background:rgba(12,12,14,.6);border:1px solid rgba(255,255,255,.08);box-shadow:0 10px 24px rgba(0,0,0,.35);transition:transform 200ms ease, box-shadow 200ms ease}
.carousel-item:hover{transform:translateY(-2px);box-shadow:0 16px 36px rgba(0,0,0,.4)}
.carousel-item.is-active{outline:0;box-shadow:0 0 0 1px rgba(255,255,255,.18),0 14px 30px rgba(0,0,0,.45)}
@media (prefers-reduced-motion: reduce){.carousel-track{transform:none}}

/* Drag + focus cleanup */
.carousel{cursor:default;user-select:none;-webkit-user-select:none;touch-action:pan-y}
.no-focus-outline{-webkit-tap-highlight-color:transparent}
.no-focus-outline:focus{outline:none}
.no-focus-outline *:focus{outline:none!important;box-shadow:none!important}
.no-focus-outline *:focus-visible{outline:none!important;box-shadow:none!important}
.no-focus-outline .carousel button{outline:none!important;box-shadow:none!important}
.no-focus-outline .carousel button:focus{outline:none!important;box-shadow:none!important}
.no-focus-outline .carousel button:focus-visible{outline:none!important;box-shadow:none!important}
.no-focus-outline button::-moz-focus-inner{border:0!important}
.no-focus-outline button:-moz-focusring{outline:none!important}

/* Center highlight band on rail */
.glass-rail{--highlight-w:120px; --highlight-h:152px; position:relative}
.glass-rail::after{content:""; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:var(--highlight-w); height:var(--highlight-h); pointer-events:none; border:1px solid rgba(255,255,255,.10); background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02)); border-radius:9999px; box-shadow:inset 0 0 0 1px rgba(255,255,255,.04), 0 0 0 1px rgba(0,0,0,.18)}

/* ========== PACK OPENING STAGE PANEL ========== */

/* Stage root - normal flow container (no fixed, no full-viewport) */
#booster-stage {
  position: relative;
  padding-inline: 16px;
  z-index: 0;
}

/* Stage Panel - centered container - z-index 1 */
.stage-panel {
  position: relative;
  max-width: 960px;
  width: min(960px, 92vw);
  min-height: 600px;
  margin-inline: auto;
  margin-top: clamp(24px, 8vh, 80px);
  margin-bottom: 40px;
  padding: 24px 24px;
  border-radius: 16px;
  background: #111418;
  border: 1px solid rgba(36, 42, 51, 0.10);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(8px);
  z-index: 1;
}

/* Stage Header - set info */
.stage-header {
  text-align: center;
  margin-bottom: 16px;
  color: rgba(255, 255, 255, 0.9);
}

/* Split header layout inside panel */
.header-split{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:24px;
  margin-bottom: 16px;
}
.header-split .h-left .label{ font-size:12px; text-transform:uppercase; letter-spacing:0.08em; color:#A9B0B8; }
.header-split .h-left .name{ font-size:18px; font-weight:600; color:#E6EAEE; }
.header-split .h-left .name .muted{ font-size:12px; opacity:.65; margin-left:6px }
.header-split .h-right{ text-align:right }
.header-split .h-right .remaining{ font-size:12px; color:#A9B0B8 }
.progress-dots{ display:flex; gap:6px; margin-top:6px; justify-content:flex-end }
.progress-dots .dot{ width:8px; height:8px; border-radius:50%; background:#242A33; box-shadow: inset 0 0 0 1px rgba(255,255,255,.06) }
.progress-dots .dot.on{ background:#1ED1A1 }

/* Stage Canvas - clipping boundary for all visuals - z-index 2 */
.stage-canvas {
  position: relative;
  min-height: 480px;
  border-radius: 16px;
  overflow: hidden;
  z-index: 2;
  /* Establish clipping context */
  isolation: isolate;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #161A20;
}

/* Anchor the stack so its visual center sits ~40% from top */
.stack-anchor{ position:absolute; top:50%; left:50%; transform: translate(-50%, -50%); width:100%; display:flex; align-items:center; justify-content:center }
.stack-anchor .card-stack-3d{ height:auto }

/* Phase-reactive ambience and stage fade */
.stage-canvas[data-phase="revealing"] .stage-ambient{ opacity:.75 }
.stage-canvas[data-phase="discarding"] .stage-ambient{ opacity:.68 }
.stage-canvas[data-phase="promoting"] .stage-ambient{ opacity:.65 }
.stage-canvas[data-phase="done"]{ opacity:0; transition: opacity 240ms ease }

/* Ambient vignette and dust backdrop */
.stage-ambient{
  position:absolute; inset:0; pointer-events:none; z-index:1;
  background: radial-gradient(80% 60% at 50% 40%, rgba(255,255,255,0.04), transparent 60%),
              radial-gradient(50% 40% at 50% 60%, rgba(0,0,0,0.35), transparent 65%);
  opacity:.6;
}

/* Stage glow layer - z-index 3 */
.stage-glow {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 3;
}

.glow-radial {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 600px;
  height: 600px;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  filter: blur(60px);
  animation: pulse-glow 3s ease-in-out infinite;
}

@keyframes pulse-glow {
  0%, 100% { 
    opacity: 0.25;
    transform: translate(-50%, -50%) scale(1);
  }
  50% { 
    opacity: 0.4;
    transform: translate(-50%, -50%) scale(1.1);
  }
}

/* 3D Card Stack - z-index 4 */
.card-stack-3d {
  position: relative;
  perspective: 2000px;
  transform-style: preserve-3d;
  touch-action: none;
  z-index: 4;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  will-change: transform;
  transform: translateZ(0) scale(var(--card-scale, 1));
  transition: opacity 320ms ease, transform 320ms ease;
}

/* Remove default focus ring lines on the stack container (we keep keyboard behavior) */
.card-stack-3d:focus { outline: none; }
.card-stack-3d:focus-visible { outline: none; }

.card-stack-inner {
  position: relative;
  width: 200px;
  height: 280px;
  transform-style: preserve-3d;
  /* GPU optimization */
  will-change: transform;
  transform: translateZ(0);
}

/* ==================== PACK ENTRY ANIMATION ==================== */
/* Stack rises from below with anticipation bounce (500ms) */
.stack-rise { 
  animation: stack-entry 500ms cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

@keyframes stack-entry {
  0% {
    transform: translateY(50px) scale(0.92);
    opacity: 0;
    filter: blur(2px) brightness(0.8);
  }
  60% {
    transform: translateY(-4px) scale(1.01);
    opacity: 1;
    filter: blur(0px) brightness(1.05);
  }
  100% {
    transform: translateY(0) scale(1);
    opacity: 1;
    filter: blur(0px) brightness(1);
  }
}

/* Light sweep across stack on entry */
.stack-entry-sweep {
  position: absolute;
  inset: -20%;
  pointer-events: none;
  background: linear-gradient(
    110deg,
    transparent 30%,
    rgba(255, 255, 255, 0.15) 50%,
    transparent 70%
  );
  transform: translateX(-100%);
  animation: entry-sweep 600ms ease-out 100ms forwards;
  mix-blend-mode: screen;
  z-index: 15;
}

@keyframes entry-sweep {
  to { transform: translateX(100%); }
}

/* Stage CTA - bottom actions */
.stage-cta {
  margin-top: 24px;
  text-align: center;
}

.cta-instruction {
  font-size: 15px;
  font-weight: 500;
  color: rgba(255, 255, 255, 0.85);
  letter-spacing: 0.01em;
}

/* Phase dots below CTA text */
.cta-dots{ display:flex; justify-content:center; gap:8px; margin-top:8px }
.tiny-dot{ width:6px; height:6px; border-radius:9999px; background:#242A33; opacity:.8 }
.tiny-dot.active{ background:#E6EAEE }
.tiny-dot.current{ background:#A9B3BC; box-shadow: 0 0 0 2px rgba(169,179,188,0.25); animation: dot-pulse 800ms ease-in-out infinite }
@keyframes dot-pulse { 0%,100%{ transform: scale(1); opacity:.95 } 50%{ transform: scale(1.15); opacity:1 } }

.cta-row {
  margin-top: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.capsule-btn { /* ensure pill look if not already defined */
  border-radius: 10px;
  padding: 8px 14px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
  color: #fff;
}

/* Bottom-right action bar within panel */
.stage-actions{ display:flex; justify-content:flex-end; gap:24px; margin-top: 12px }

/* Card stack item - z-index 1000-stackPos */
.card-stack-item {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 300ms cubic-bezier(0.22, 0.61, 0.36, 1), 
              filter 300ms ease, 
              opacity 300ms ease;
  /* GPU layer for smooth animations */
  will-change: transform, opacity, filter;
  backface-visibility: hidden;
  -webkit-font-smoothing: antialiased;
}

.card-scale {
  transform: scale(1.12);
  transform-origin: center;
  transition: transform 0.3s ease;
  position: relative;
}
.intro-scale {
  animation: intro-fade 520ms cubic-bezier(0.22, 1, 0.36, 1) both;
}

@keyframes intro-fade {
  from { opacity: 0; filter: blur(6px) brightness(0.9); }
  to   { opacity: 1; filter: blur(0px) brightness(1); }
}

/* Make stack visible */
.card-stack-item:not(.card-discarding) {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

/* Shine now handled within the card component itself */

/* ==================== FAST SWIPE DISCARD (Right) ==================== */
.card-discarding {
  animation: card-swipe-discard 360ms cubic-bezier(.22,.61,.36,1) forwards !important;
  pointer-events: none !important;
  will-change: transform, opacity, filter;
}

@keyframes card-swipe-discard {
  0% { transform: translate3d(0,0,0) rotateZ(0deg) scale(1); opacity: 1; filter: brightness(1) }
  30% { transform: translate3d(12px,-6px,20px) rotateZ(-4deg) scale(1.02); filter: brightness(1.05) }
  100% { transform: translate3d(260px,-18px,24px) rotateZ(-10deg) scale(0.98); opacity: 0; filter: brightness(.95) blur(1px) }
}

/* ==================== CINEMATIC CARD PROMOTE SYSTEM ==================== */
/* Next card rises smoothly with overshoot settle (250ms) */

.card-promoting {
  animation: card-cinematic-promote 300ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards !important;
  will-change: transform, opacity, filter;
}

@keyframes card-cinematic-promote {
  0% {
    transform: translate3d(0, 16px, -10px) scale(0.96);
    filter: brightness(0.88) blur(1px);
    opacity: 0.6;
  }
  60% {
    transform: translate3d(0, -4px, 0) scale(1.03);
    filter: brightness(1.04);
    opacity: 1;
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
    filter: brightness(1);
    opacity: 1;
  }
}

/* Stack compress/settle when top leaves */
.stack-compress { 
  animation: stack-compress 200ms cubic-bezier(0.34, 1.56, 0.64, 1) both;
}
@keyframes stack-compress { 
  0%{ transform: translateY(0) scale(1) } 
  45%{ transform: translateY(8px) scale(0.98) } 
  100%{ transform: translateY(0) scale(1) } 
}

/* Intro light sweep on stack */
.intro-sweep{ position: relative }
.intro-sweep::after{ content:''; position:absolute; inset:-10% -30%; background: linear-gradient(110deg, transparent 40%, rgba(255,255,255,.12) 50%, transparent 60%); filter: blur(10px); transform: translateX(-40%); pointer-events:none; animation: sweep-once 520ms ease-out both }
@keyframes sweep-once { to { transform: translateX(40%); opacity: 0 } }

/* ==================== RARITY VFX SYSTEM ==================== */

/* Energy ring burst during discard - overlaps with lift phase */
.vfx-burst { 
  position: absolute; 
  inset: -12%; 
  border-radius: 18px; 
  pointer-events: none; 
  mix-blend-mode: screen; 
  animation: burst-ring 280ms ease-out forwards;
  z-index: 10;
}

.vfx-burst::before { 
  content: ''; 
  position: absolute; 
  inset: 0; 
  border-radius: inherit; 
  background: radial-gradient(circle at center, var(--burst-color, rgba(255,255,255,.5)) 0%, rgba(255,255,255,0) 65%); 
  filter: blur(8px);
}

@keyframes burst-ring { 
  0% { opacity: 0.8; transform: scale(0.88) rotate(0deg); } 
  100% { opacity: 0; transform: scale(1.35) rotate(5deg); } 
}

/* Rarity color mapping */
.card-stack-item .vfx-burst[data-rank="10"] { --burst-color: rgba(255, 215, 0, 0.85); }
.card-stack-item .vfx-burst[data-rank="9"],
.card-stack-item .vfx-burst[data-rank="8"] { --burst-color: rgba(255, 100, 255, 0.75); }
.card-stack-item .vfx-burst[data-rank="7"],
.card-stack-item .vfx-burst[data-rank="6"] { --burst-color: rgba(100, 200, 255, 0.65); }

/* Foil shimmer for D4/D5 cards - brief streak before throw */
.vfx-foil-shimmer {
  position: absolute;
  inset: -20%;
  pointer-events: none;
  mix-blend-mode: screen;
  animation: foil-shimmer-sweep 450ms cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
  z-index: 8;
}

.vfx-foil-shimmer::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    100deg,
    transparent 0%,
    rgba(255, 255, 255, 0.15) 35%,
    rgba(200, 230, 255, 0.25) 50%,
    rgba(255, 255, 255, 0.15) 65%,
    transparent 100%
  );
  transform: translateX(-120%) skewX(-15deg);
  animation: foil-sweep-pass 450ms cubic-bezier(0.22, 0.61, 0.36, 1) forwards;
}

@keyframes foil-sweep-pass {
  to { transform: translateX(120%) skewX(-15deg); }
}

/* Iridescent flare for S4/CROWN - brief lens flare effect */
.vfx-iridescent-flare {
  position: absolute;
  inset: -30%;
  pointer-events: none;
  mix-blend-mode: screen;
  animation: iridescent-flare 550ms ease-out forwards;
  z-index: 9;
}

.vfx-iridescent-flare::before {
  content: '';
  position: absolute;
  inset: 0;
  background: 
    radial-gradient(ellipse at 50% 50%, rgba(255, 255, 255, 0.4), transparent 35%),
    conic-gradient(from 0deg, 
      rgba(255, 100, 255, 0.3),
      rgba(100, 200, 255, 0.3),
      rgba(255, 255, 100, 0.3),
      rgba(255, 100, 255, 0.3)
    );
  filter: blur(12px);
  animation: flare-pulse 550ms ease-out forwards;
}

@keyframes flare-pulse {
  0% { opacity: 0; transform: scale(0.7) rotate(0deg); }
  40% { opacity: 0.9; transform: scale(1.1) rotate(15deg); }
  100% { opacity: 0; transform: scale(1.4) rotate(30deg); }
}

/* ==================== STAGE LIGHTING & CAMERA EFFECTS ==================== */

/* Subtle camera shift during discard for kinetic feel */
.stage-canvas { 
  transition: transform 300ms cubic-bezier(0.22, 0.61, 0.36, 1), filter 300ms ease;
  will-change: transform, filter;
}

[data-phase='discarding'] .stage-canvas { 
  transform: perspective(1200px) rotateX(0.8deg) translateY(-2px);
  filter: brightness(1.03) contrast(1.02);
}

[data-phase='discarding'] .stage-glow .glow-radial { 
  transform: translate(-50%, -50%) scale(1.08); 
  opacity: 0.5;
  transition: all 350ms ease-out;
}

/* Ambient light pulse on high-rarity reveals */
.stage-ambient-pulse {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(60% 50% at 50% 45%, var(--ambient-color, rgba(255, 255, 255, 0.08)), transparent 70%);
  opacity: 0;
  animation: ambient-pulse 800ms ease-out forwards;
  z-index: 2;
}

@keyframes ambient-pulse {
  0% { opacity: 0; transform: scale(0.9); }
  50% { opacity: 0.6; transform: scale(1.0); }
  100% { opacity: 0; transform: scale(1.1); }
}

/* Reduced motion variant */
[data-motion='reduce'] .card-discarding{ animation: card-discard-reduced 300ms ease forwards !important }
[data-motion='reduce'] .stack-compress{ animation: none }
[data-motion='reduce'] .intro-sweep::after{ display: none }
[data-motion='reduce'] .vfx-burst{ display: none }


/* Particle container - clipped within canvas - z-index 5 */
.particle-container {
  position: absolute;
  inset: 0;
  pointer-events: none;
  /* Particles stay within canvas bounds */
  overflow: visible;
  z-index: 5;
}

.particle {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  box-shadow: 0 0 8px currentColor;
  filter: blur(0.5px);
}

/* ==================== ENHANCED PARTICLE SYSTEM ==================== */

/* Particle burst with shimmer trail */
@keyframes particle-burst {
  0% {
    transform: translate(-50%, -50%) rotate(var(--angle)) translateY(0px) scale(1);
    opacity: 1;
    filter: blur(0px) brightness(1.5);
  }
  30% {
    opacity: 1;
    filter: blur(0.5px) brightness(1.8);
  }
  70% {
    opacity: 0.7;
    filter: blur(1px) brightness(1.3);
  }
  100% {
    transform: translate(-50%, -50%) rotate(var(--angle)) translateY(calc(var(--distance) * -1)) scale(0.2);
    opacity: 0;
    filter: blur(2px) brightness(1);
  }
}

/* Particle shimmer trail effect */
.particle::after {
  content: '';
  position: absolute;
  inset: -50%;
  background: inherit;
  border-radius: inherit;
  opacity: 0.4;
  filter: blur(3px);
  animation: particle-trail 1.2s ease-out forwards;
  animation-delay: inherit;
}

@keyframes particle-trail {
  0% { transform: scale(1); opacity: 0.4; }
  100% { transform: scale(2.5); opacity: 0; }
}

/* ==================== REDUCED MOTION VARIANTS ==================== */
/* Simplified animations if OS requests reduced motion, unless app forces full. */

@media (prefers-reduced-motion: reduce) {
  .stage-canvas:not([data-motion='full']) .card-discarding {
    animation: card-discard-reduced 400ms ease forwards !important;
  }
  
  @keyframes card-discard-reduced {
    0% { opacity: 1; transform: scale(1); }
    100% { opacity: 0; transform: scale(0.95); }
  }
  
  .stage-canvas:not([data-motion='full']) .card-promoting {
    animation: card-promote-reduced 300ms ease forwards !important;
  }
  
  @keyframes card-promote-reduced {
    0% { opacity: 0.5; transform: scale(0.98); }
    100% { opacity: 1; transform: scale(1); }
  }
  
  .stage-canvas:not([data-motion='full']) .card-stack-item {
    transition: opacity 200ms ease, transform 200ms ease !important;
  }
  
  .stage-canvas:not([data-motion='full']) .glow-radial {
    animation: none;
    opacity: 0.2;
  }
  
  .stage-canvas:not([data-motion='full']) .particle,
  .stage-canvas:not([data-motion='full']) .particle::after,
  .stage-canvas:not([data-motion='full']) .vfx-burst,
  .stage-canvas:not([data-motion='full']) .vfx-foil-shimmer,
  .stage-canvas:not([data-motion='full']) .vfx-iridescent-flare,
  .stage-canvas:not([data-motion='full']) .stage-ambient-pulse {
    display: none !important;
  }
  
  .stage-canvas:not([data-motion='full']) .stack-rise { animation: none !important; }
  .stage-canvas:not([data-motion='full']) .intro-scale { animation: none !important; }
  .stage-canvas:not([data-motion='full']) .stack-compress { animation: none !important; }
  
  .stage-canvas:not([data-motion='full']) {
    transform: none !important;
    filter: none !important;
  }
}

/* User-controlled reduced motion override */
[data-motion='reduce'] .card-discarding { 
  animation: card-discard-reduced 400ms ease forwards !important; 
}
[data-motion='reduce'] .card-promoting { 
  animation: card-promote-reduced 300ms ease forwards !important; 
}
[data-motion='reduce'] .particle,
[data-motion='reduce'] .vfx-burst,
[data-motion='reduce'] .vfx-foil-shimmer,
[data-motion='reduce'] .vfx-iridescent-flare,
[data-motion='reduce'] .stage-ambient-pulse {
  display: none !important;
}

/* Responsive adjustments */
@media (max-width: 640px) {
  .stage-panel {
    width: 95vw;
    margin-top: 12px;
    margin-bottom: 12px;
    padding: 20px 24px;
    min-height: 520px;
  }
  
  .stage-canvas {
    min-height: 400px;
  }
  
  .card-stack-inner {
    width: 220px;
    height: 308px;
  }
  
  .card-scale {
    transform: scale(1.1);
  }
}
